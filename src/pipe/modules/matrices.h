#ifndef MATRICES_H
#define MATRICES_H
// this header provides access to frequently used colour matrices, in a unified place for c/host and glsl/device.
// note that some single-use matrices such as for dtucs or oklab remain in their respective conversion functions
// as these don't seem very useful without the code surrounding them directly.

#ifndef GL_core_profile // c version
#define makemat(A,B,C,D,E,F,G,H,I) \
{ A, B, C, \
  D, E, F, \
  G, H, I }
#define makevec(A,B,C) {A,B,C}
#else // glsl gives matrices as three column vectors:
#define makemat(A,B,C,D,E,F,G,H,I) mat3(\
  A, D, G, \
  B, E, H, \
  C, F, I )
#define makevec(A,B,C) vec3(A,B,C)
#endif

// chromatic adaptation transform matrices, CAT16 M and inverse
// Smet and Ma, "Some concerns regarding the CAT16 chromatic adaptation transform",
// Color Res Appl. 2020;45:172â€“177.
// M: XYZ to cone-like
#define matrix_cat16_Mi makemat(1.86206786, -1.01125463,  0.14918677, 0.38752654,  0.62144744, -0.00897398, -0.01584150, -0.03412294,  1.04996444)
#define matrix_cat16_M  makemat(0.401288, 0.650173, -0.051461, -0.250268, 1.204414,  0.045854, -0.002079, 0.048952,  0.953127)
// the reference white points converted from XYZ to cat16 cone-like via M
#define white_cat16_a   makevec(1.07267804, 0.94580946, 0.38579081)
#define white_cat16_d50 makevec(0.99463442, 1.00093973, 0.83337252)
#define white_cat16_d55 makevec(0.98670919, 1.00720745, 0.92517403)
#define white_cat16_d60 makevec(0.98054329, 1.01225584, 1.00850997)
#define white_cat16_d65 makevec(0.97552638, 1.01648513, 1.0847408)
#define white_cat16_d75 makevec(0.9681735,  1.0229639,  1.21587342)
#define white_cat16_d93 makevec(0.95990494, 1.03068499, 1.39349395)

// these adapt XYZ from/to the given white points:
#define matrix_cat16_a_to_d65 makemat(9.50674182e-01, -1.87430902e-01,  2.62831155e-01, -2.56724729e-02, 1.03231456e+00, -1.15608371e-02, -2.74089665e-03,  9.09809774e-02, 2.81290019e+00)
#define matrix_cat16_d50_to_d65 makemat(9.89482020e-01, -3.99715078e-02,  4.40103520e-02, -5.39737108e-03, 1.00665157e+00, -1.75423920e-03, -4.03659609e-04,  1.50625995e-02, 1.30181385e+00)
#define matrix_cat16_d55_to_d65 makemat(9.93809109e-01, -2.36805157e-02,  2.51833773e-02, -3.19186083e-03, 1.00396313e+00, -9.86707812e-04, -2.25775304e-04,  8.60286147e-03, 1.17257778e+00)
#define matrix_cat16_d60_to_d65 makemat(9.97210818e-01, -1.07310837e-02,  1.10446315e-02, -1.44406069e-03, 1.00180486e+00, -4.25428414e-04, -9.67926098e-05,  3.76602349e-03, 1.07563353e+00)
#define matrix_cat16_d75_to_d65 makemat(1.00410545e+00,  1.61206883e-02, -1.57697661e-02,  2.16403273e-03, 9.97220529e-01,  5.90558927e-04,  1.33059688e-04, -5.36122439e-03, 8.92084722e-01)
#define matrix_cat16_d93_to_d65 makemat(1.00874225e+00,  3.48643084e-02, -3.24261661e-02,  4.66935441e-03, 9.93885810e-01,  1.17801519e-03,  2.62546309e-04, -1.09895081e-02, 7.78301142e-01)


// the most braindead of all adaptation matrices:
#define matrix_e_to_d50 makemat(0.9977545, -0.0041632, -0.0293713, -0.0097677,  1.0183168, -0.0085490, -0.0074169,  0.0134416,  0.8191853)

// XYZ
#define matrix_rec2020_to_xyz makemat(0.636958048301290991, 0.144616903586208406, 0.168880975164172054, 0.26270021201126692, 0.677998071518871148, 0.0593017164698619384, 4.9999999999999999e-17, 0.0280726930490874452, 1.06098505771079066)
#define matrix_xyz_to_rec2020 makemat(1.71665119, -0.35567078, -0.25336628, -0.66668435,  1.61648124,  0.01576855, 0.01763986, -0.04277061, 0.94210312)

// display P3: using D65 white
#define matrix_p3d65_to_rec2020 makemat(0.75386031,  0.19861268, 0.04757049, 0.04575344,  0.94178472, 0.01247032, -0.00121501, 0.01760596, 0.98321971)
#define matrix_rec2020_to_p3d65 makemat(1.34353337, -0.28218904, -0.06142427, -0.06530851,  1.07578268, -0.01048453, 0.00282971, -0.01961215,  1.01717851)

// Adobe RGB
#define matrix_adobergb_to_rec2020 makemat(0.87736306, 0.07751751, 0.04516292, 0.0966218, 0.89152263, 0.01186405, 0.02291617, 0.04301452, 0.93367996)
#define matrix_rec2020_to_adobergb makemat(1.15194302, -0.09753232, -0.05448118, -0.12454585, 1.13290963, -0.00837122, -0.02253539, -0.04979918, 1.07275365)
#define matrix_xyz_to_adobergb makemat(2.0413690, -0.5649464, -0.3446944, -0.9692660, 1.8760108, 0.0415560, 0.0134474, -0.1183897, 1.0154096)
#define matrix adobergb_to_xyz makemat(0.5767309, 0.1855540, 0.1881852, 0.2973769, 0.6273491, 0.0752741, 0.0270343, 0.0706872, 0.9911085)

// rec709 (sRGB primaries) to rec2020
#define matrix_rec709_to_rec2020 makemat(0.62750375, 0.32927542, 0.04330266, 0.06910828, 0.91951916, 0.0113596, 0.01639406, 0.08801125, 0.89538035)
#define matrix_rec2020_to_rec709 makemat(1.66022677, -0.58754761, -0.07283825, -0.12455334,  1.13292605, -0.00834963, -0.01815514, -0.10060303,  1.11899817)

// yuv
#define matrix_rec709_to_yuv makemat(0.299, 0.587, 0.114, -0.147, -0.289, 0.436, 0.615, -0.515, -0.100)
#define matrix_yuv_to_rec709 makemat(1.0, -3.94570707e-05, 1.13982797, 1.0, -3.94610164e-01, -5.80500316e-01, 1.0, 2.03199968, -4.81376263e-04)

// M3 in ITU-R BT.2087-0 goes from rec2020 to YCbCr (both normalised)
#define matrix_rec2020_to_ycbcr makemat(0.2627, 0.6780, 0.0593, -0.2627/1.8814, -0.6780/1.8814, 0.5, 0.5, -0.6780/1.4746, -0.0593/1.4746)
#define matrix_ycbcr_to_rec2020 makemat(1, 0.0, 1.4746, 1, -0.164553127, -0.571353127, 1, 1.8814, 0.0)
#define matrix_ycbcr_to_rec709  makemat(1.0, 0.0, 1.5748, 1.0, -0.0722 * 1.8556 / 0.7152, -0.2126 * 1.5748 / 0.7152, 1.0, 1.8556, 0.0)                       
// matrix definitions from OpenDRT
// ACES AP0 to XYZ D65 (CAT02)
#define matrix_ap0_to_xyz makemat(0.938630948750273197, -0.00574192055037397141, 0.017566898851772296, 0.338093594922021567, 0.72721390281143572, -0.0653074977334571899, 0.000723121511341165988, 0.000818441849244731985, 1.08751618739929268)
// ACES AP1 to XYZ D65 (CAT02)
#define matrix_ap1_to_xyz makemat(0.652418717671912951, 0.127179925537538263, 0.170857283842220459, 0.268064059194271287, 0.672464478992617742, 0.0594714618131108388, -0.0054699285104975676, 0.00518279997697511721, 1.08934487929340107)
#define matrix_arriwg3_to_xyz makemat(0.638007619284, 0.214703856337, 0.097744451431, 0.291953779, 0.823841041511, -0.11579482051, 0.002798279032, -0.067034235689, 1.15329370742)
#define matrix_arriwg4_to_xyz makemat(0.704858320407231953, 0.129760295170463003, 0.115837311473976537, 0.254524176404026969, 0.781477732712002049, -0.0360019091160290391, 0.0, 0.0, 1.08905775075987843)
#define matrix_redwg_to_xyz makemat(0.735275245905858799, 0.0686094106139610721, 0.14657127053185201, 0.286694099499934962, 0.842979134016975662, -0.129673233516910319, -0.0796808568783676785, -0.347343216994429771, 1.51608182463267593)
#define matrix_sonysgamut3_to_xyz makemat(0.706482713192318812, 0.12880104979055762, 0.115172164068795255, 0.270979670813492168, 0.786606411220905466, -0.0575860820343976273, -0.00967784538619615754, 0.00460003749251991934, 1.09413555865355483)
#define matrix_sonysgamut3cine_to_xyz makemat(0.599083920758327171, 0.248925516115423628, 0.102446490177920776, 0.215075820115587457, 0.88506850174372842, -0.100144321859315821, -0.0320658495445057951, -0.0276583906794915374, 1.1487819909838759)
#define matrix_vgamut_to_xyz makemat(0.679644469878, 0.15221141244, 0.118600044733, 0.26068555009, 0.77489446333, -0.03558001342, -0.009310198218, -0.004612467044, 1.10298041602)
#define matrix_egamut_to_xyz makemat(0.705396850087770755, 0.164041328309919021, 0.0810177486539819941, 0.280130724091105898, 0.820206641549595106, -0.100337365640700782, -0.103781511569163279, -0.0729072570266306313, 1.26574651935567273)
#define matrix_egamut2_to_xyz makemat(0.736477700183697404, 0.130739651086660136, 0.0832385757813140781, 0.275069984405959256, 0.828017790215514138, -0.103087774621473588, -0.124225154247852534, -0.0871597673911067433, 1.30044267239883782)
#define matrix_davinciwg_to_xyz makemat(0.700622392093671609, 0.148774815123196763, 0.101058719834803246, 0.274118510906649016, 0.873631895940436665, -0.147750406847085763, -0.0989629128832311411, -0.137895325075543307, 1.32591598871865268)
// P3D65 to XYZ D65
#define matrix_p3d65_to_xyz makemat(0.486570948648216151, 0.265667693169093, 0.198217285234362467, 0.228974564069748754, 0.691738521836506193, 0.079286914093744984, -4.00000000000000029e-17, 0.0451133818589026167, 1.04394436890097575)
// XYZ D65 to P3D65
#define matrix_xyz_to_p3d65 makemat(2.49349691194142542, -0.93138361791912383, -0.402710784450716841, -0.829488969561574696, 1.76266406031834655, 0.0236246858419435941, 0.0358458302437844531, -0.0761723892680418041, 0.956884524007687309)
// Rec709 to XYZ D65
#define matrix_rec709_to_xyz makemat(0.412390799265959229, 0.357584339383878125, 0.180480788401834347, 0.212639005871510217, 0.71516867876775625, 0.0721923153607337414, 0.0193308187155918181, 0.119194779794626018, 0.950532152249661033)
// XYZ D65 to Rec709
#define matrix_xyz_to_rec709 makemat(3.24096994190452348, -1.53738317757009435, -0.498610760293003552, -0.969243636280879506, 1.87596750150771996, 0.0415550574071755843, 0.0556300796969936354, -0.20397695888897649, 1.05697151424287816)
// P3D65 to Rec2020
#define matrix_p3_to_rec2020 makemat(0.753833034361722221, 0.198597369052616435, 0.0475695965856618441, 0.0457438489653582137, 0.9417772198116936, 0.0124789312229481135, -0.0012103403545183941, 0.0176017173010899926, 0.983608623053428777)
// P3DCI to XYZ DCI (NPM Matrix)
#define matrix_p3dci_to_xyz makemat(0.445169815564552429, 0.27713440920677751, 0.172282669815564504, 0.209491677912730545, 0.721595254161043309, 0.0689130679262257989, -3.59999999999999995e-17, 0.0470605600539811264, 0.9073553943619731)
// DCI to D93 : [0.314, 0.351] to [0.283, 0.297]
#define matrix_cat_dci_to_d93 makemat(0.965685009956359863, 0.00183745240792632103, 0.0912967324256896973, 0.000514572137035429044, 0.965166747570037842, 0.036014653742313385, 0.00154250487685203596, 0.00702651776373386383, 1.47287476062774658)
// DCI to D75 : [0.314, 0.351] to [0.29903, 0.31488]
#define matrix_cat_dci_to_d75 makemat(0.990120768547058105, 0.0151389474049210548, 0.0511047691106796265, 0.0102197211235761642, 0.971718132495880127, 0.0200536623597145081, 0.000743072712793946049, 0.0042176349088549614, 1.27959656715393066)
// DCI to D65 : [0.314, 0.351] to [0.3127, 0.329]
#define matrix_cat_dci_to_d65 makemat(1.00951600074768066, 0.0269675441086292267, 0.0213620811700820923, 0.0187991037964820862, 0.975330352783203125, 0.0082273334264755249, 0.000134543282911180989, 0.00217903498560190201, 1.138663649559021)
// DCI to D60 : [0.314, 0.351] to [0.32162624, 0.337737]
#define matrix_cat_dci_to_d60 makemat(1.02159523963928223, 0.034848678857088089, 0.00371252000331878705, 0.0244968775659799576, 0.976937234401702881, 0.00120301544666290305, -0.00023391586728393999, 0.000986687839031219049, 1.05594265460968018)
// DCI to D55 : [0.314, 0.351] to [0.33243, 0.34744]
#define matrix_cat_dci_to_d55 makemat(1.03594577312469482, 0.0450937561690807343, -0.0157573819160461426, 0.0318740680813789368, 0.977744519710540771, -0.00655744969844818115, -0.000653609400615095984, -0.000297372229397297014, 0.966327786445617676)
// DCI to D50 : [0.314, 0.351] to [0.3457, 0.3585]
#define matrix_cat_dci_to_d50 makemat(1.05306875705718994, 0.0581297315657138824, -0.0376100838184356689, 0.0412359423935413361, 0.977693676948547363, -0.0152792222797870636, -0.00113777676597237609, -0.00170759297907352404, 0.867368340492248535)
// D65 to D93 : [0.3127, 0.329] to [0.283, 0.297]
#define matrix_cat_d65_to_d93 makemat(0.95703423023223877, -0.0247171502560377121, 0.0624028593301773071, -0.0179296955466270447, 0.990019857883453369, 0.0248119533061981201, 0.00127589143812656403, 0.00427919067442417058, 1.29345715045928955)
// D65 to D75 : [0.3127, 0.329] to [0.29903, 0.31488]
#define matrix_cat_d65_to_d75 makemat(0.981001079082489014, -0.0116619253531098366, 0.0265614092350006104, -0.00843488052487373352, 0.996506094932556152, 0.0105696544051170349, 0.000552809564396739006, 0.00179840810596942902, 1.12374722957611084)
// D65 to D60 : [0.3127, 0.329] to [0.32162624, 0.337737]
#define matrix_cat_d65_to_d60 makemat(1.01182246208190918, 0.00778879318386316299, -0.0157783031463623047, 0.00561682833358645439, 1.00150644779205322, -0.00628517568111419678, -0.000335735734552145004, -0.0010509500280022619, 0.927366673946380615)
// D65 to D55 : [0.3127, 0.329] to [0.33243, 0.34744]
#define matrix_cat_d65_to_d55 makemat(1.02585089206695557, 0.0179439820349216461, -0.0332137793302536011, 0.0129133854061365128, 1.00214779376983643, -0.0132421031594276428, -0.000719940289855003032, -0.00218106806278228803, 0.84868013858795166)
// D65 to D50 : [0.3127, 0.329] to [0.3457, 0.3585]
#define matrix_cat_d65_to_d50 makemat(1.04257404804229736, 0.03089117631316185, -0.052812620997428894, 0.0221935361623764038, 1.00185668468475342, -0.0210737623274326324, -0.00116488314233720303, -0.00342052709311246915, 0.761789083480834961)
// D65 to DCI-P3 : [0.3127, 0.329] to [0.314, 0.351]
#define matrix_cat_d65_to_dci makemat(0.991085588932037354, -0.0273622870445251465, -0.0183956623077392578, -0.0191021915525197983, 1.02583777904510498, -0.00705372542142868042, -8.05503223091359977e-05, -0.00195988826453685804, 0.878238439559936523)
// D60 to D93 : [0.32162624, 0.337737] to [0.283, 0.297]
#define matrix_cat_d60_to_d93 makemat(0.946056902408599854, -0.0319503024220466614, 0.0831701457500457764, -0.0231979694217443466, 0.988745808601379395, 0.0330617502331733704, 0.00169203430414199807, 0.00572328735142946243, 1.39483106136322021)
// D60 to D75 : [0.32162624, 0.337737] to [0.29903, 0.31488]
#define matrix_cat_d60_to_d75 makemat(0.969659984111785889, -0.019138311967253685, 0.0450099557638168335, -0.0138545772060751915, 0.995133817195892334, 0.0179062262177467346, 0.000931452261283994046, 0.00306008197367191315, 1.21179807186126709)
// D60 to D65 : [0.32162624, 0.337737] to [0.3127, 0.329]
#define matrix_cat_d60_to_d65 makemat(0.988363921642303467, -0.00766910053789615631, 0.0167641639709472656, -0.0055409618653357029, 0.998546123504638672, 0.00667332112789154139, 0.000351537019014359008, 0.00112883746623992898, 1.07833576202392578)
// D60 to D55 : [0.32162624, 0.337737] to [0.33243, 0.34744]
#define matrix_cat_d60_to_d55 makemat(1.01380288600921631, 0.0100131509825587273, -0.018498346209526062, 0.00720565160736441612, 1.00057685375213623, -0.00737529993057250977, -0.000401133671402930997, -0.00121434964239597299, 0.915135681629180908)
// D60 to D50 : [0.32162624, 0.337737] to [0.3457, 0.3585]
#define matrix_cat_d60_to_d50 makemat(1.03025269508361816, 0.0227910466492176056, -0.0392656922340393066, 0.0163766480982303619, 1.00020599365234375, -0.0156668238341808319, -0.000864576781168579947, -0.00254668481647968292, 0.821422040462493896)

#endif
